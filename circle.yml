machine:
  services:
    - postgresql
  pre:
    - mkdir -p $HOME/.go_project/src/github.com/oursky
    - mv ourd $HOME/.go_project/src/github.com/oursky/
    - ln -s $HOME/.go_project/src/github.com/oursky/ourd .

dependencies:
  pre:
    - git clone git://github.com/jedisct1/libsodium.git
    - ( cd libsodium; ./autogen.sh; ./configure; make check; sudo make install; sudo ldconfig )
    - git clone git://github.com/zeromq/libzmq.git
    - ( cd libzmq; ./autogen.sh; ./configure; make check; sudo make install; sudo ldconfig )
    - git clone git://github.com/zeromq/czmq.git
    - ( cd czmq; ./autogen.sh; ./configure; make check; sudo make install; sudo ldconfig )
  post:
    - >
      go get golang.org/x/tools/cmd/cover \
             github.com/golang/lint/golint \
             github.com/smartystreets/goconvey/convey \
             github.com/smartystreets/assertions \
             golang.org/x/tools/cmd/stringer \
             github.com/rickmak/gocyclo \
             github.com/oursky/gogocyclo

    - go install

test:
  override:
    - golint ./...
    - gocyclo -skip-godeps -over 15 . | gogocyclo
    - go generate ./...
    - go test -cover ./...

database:
  post:
    - psql -c 'CREATE DATABASE ourd_test;' -U ubuntu
    - psql -c 'CREATE EXTENSION postgis;' -U postgres -d ourd_test
